---
title: "Harbor Seal Contract Report"
author: "Jeff Laake"
date: "9/28/2020"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
---



```{r options, results="hide", echo=FALSE}
suppressMessages(knitr::opts_chunk$set(echo = FALSE, results="hide"))
library(pander)
library(xtable)

load(file="gl_bootstraps.rda")
load(file="gl_models.rda")

nreps=length(bs_results)
bspar_N=with(bs_results,sapply(bs_results,function(x)x[[1]]))
llpar_N=apply(bspar_N,1,function(x) sort(x)[nreps*0.025])
ulpar_N=apply(bspar_N,1,function(x) sort(x)[nreps*0.975])

bsMNPL=with(bs_results,sapply(bs_results,function(x)x[[5]]))
llMNPL=apply(bsMNPL,1,function(x) sort(x)[nreps*0.025])
ulMNPL=apply(bsMNPL,1,function(x) sort(x)[nreps*0.975])

bsMNPLratio=with(bs_results,sapply(bs_results,function(x)x[[6]]))
llMNPLratio=apply(bsMNPLratio,1,function(x) sort(x)[nreps*0.025])
ulMNPLratio=apply(bsMNPLratio,1,function(x) sort(x)[nreps*0.975])


```




Final Report for Purchase Order No. 1305M319PNFFS0315 HARBOR SEAL DATA ANALYSIS

# Abstract
Aerial survey count data from 1975-2019 were combined with tidal survey data to provide regional and stock estimates of abundance for 1) Hood Canal stock (HC), 2) Southern Puget Sound stock (SPS), 3) Northern Inland stock (NI), and 4) the Washington portion of the WA/OR coastal stock (C). Generalized logistic population growth curves were fitted to all stocks except for Hood Canal which only had data available from 1991 and there was insufficient growth to fit a curve. The population size at the most recent survey (2019 for SPS and NI and 2014 for C) was above MNPL for these stocks and thus conclude that they are within their OSP range.  No such conclusion can be reached for Hood Canal. Abundance estimates with 95% confidence intervals and NMin values were calculated for inclusion in stock assessment reports. PBR values can be calculated from NMin but were not provided here as they require an agreement on the status of the stocks to set the $F_r$ value. All of the R code and data used for the analysis and result files are available at https://drive.google.com/drive/folders/1HQXJ4HBwHsu040EKQoV9RduHWej1et9T?usp=sharing and will remain there at least through 1 January 2021.


# Data
Aerial survey data from 1975-2019 were gathered from two files provided by NMML and WDFW. The file containing data from 1999-2019 were ready for analysis except for the completion of tidal data at time of the surveys for Hood Canal to construct the abundance estimate based on the London et al correction factor. The historical data from 1975-1998 were in need of filtering and data from 1997 were missing and unavailable.

The R source code files pvCode.r and functions.r create a single data file for harbor seals named pvdf.csv (dataframe pv.df) from the input files OldDataImport.csv (data prior to 1999) and PolygonAerialData.csv (data from 1999-2019). For the historical data there appeared to be duplicate records in the file, so any duplicate records defined by duplicate data for the first 10 fields were removed.  In addition there were errors in the Sitecode values for 6 records, and these are documented in the code with the new replaced values (lines 69-75 in pvCode.r). When the aerial surveys are conducted an estimate is made of the number of seals present.  If for some reason the photograph could not be counted, the estimated count was assigned to the count (lines 91-94 of pvCode.r). Region and Stock fields were not available in the historical data, so they were assigned using the Sitecode, Region and Stock values from the newer data and any missing values were assigned based on parsing the Sitecode (eg 9.x is Eastern Bays) (see lines 97-137 in pvCode.r). That assignment had already been done in the newer data.

For both data sets, counts of seals in the water were removed and any counts in Oregon were removed. The closest tide station was assigned using the file "LocationTideStation.csv" which contained Sitecode and closest tide station.  Any missing values were assigned based on the Sitecode region. The site location, survey time and closest tide station was sent to Josh London with NMML who retrieved tidal data to assign to each count.  The data included nearest_high_height and nearest_low_height (tide height in feet at nearest high and low), tide height at that time and time in minutes from nearest high and from nearest low tide. The data in sequence order (seq) are in Tidesfrom Josh.csv and were appended as columns to the data. Counts at the same location within 50 minutes were combined (see combine.surveytime in functions.r).

The fields in pv.df other than the tidal data were as follows: 1) Sitecode (numeric), 2) Day - date of survey in year month day (read in as character), 3) Survey.time  - survey date and time in POSIXct format, 4) Species - all PV, 5) Count.total - count of all seals, 6) Count.pups - count of pups, 7) Count.nonpups - count of non-pups, 8) Estimated.total - estimated total count at time of survey (not used), 9) Estimated.pups - estimated total pups at time of survey, 10) Region - ten region names within the 4 stocks, 11) Stock - Either Hood Canal, Coastal, Northern Inland or Southern Puget Sound, 12) Tidestation - name of closest tide station, 13) Year - numeric year value, 14) Julian - julian day for survey, 15) year - year as factor variable, 16-20 tidal values. 

For the analysis specific years and range of survey dates were selected. This selection was done in the script data_selection.r which reads in the pvdf.csv file and creates the dataframe pv.df.seldatesyears which is used throughout the analysis code.  The range of julian days used was 198-245 for Northern Inland and Southern Puget Sound stocks, 234-314 for Hood Canal and 121-181 for coastal Washington regions.  Only years with at least one complete survey of each region was used. The selected years by region are contained in the code from lines 21-27 of data_selection.r.   To repeat the analysis it is only necessary to run the script data_selection.r which reads in the pvdf.csv file and then run the analysis scripts described below.


# Methods

Abundance estimation 

Replicate counts

## Haulout correction
HC
Other stocks - Huber et al 1.53

## Population Growth and Status

Model Fitting
Bootstraps
OSP evaluation


# Results

## Hood Canal Stock

## Southern Puget Sound Stock

## Northern Inland Stock

## Coastal Washington Portion of WA/OR Stock


Literature Cited

Huber et al

Jeffries et al

London et al


```{r, results='asis'}
cat('\\pagebreak')
```
# Tables

Table 1. Counts, abundance estimates with standard error, coefficient of variation (CV) and 95% confidence intervals (LCL, UCL) and Nmin value for Hood Canal stock from aerial survey data for years between 1991-2019.
```{r,results='asis',echo=FALSE}
HC=read.csv("HCresults.csv")
pander(HC)
```

Table 2. Counts, abundance estimates with standard error, coefficient of variation (CV) and 95% confidence intervals (LCL, UCL) and Nmin value for Southern Puget Sound stock from aerial survey data for years between 1985-2019.
```{r,results='asis',echo=FALSE}
SPS=read.csv("SPSresults.csv")
pander(SPS)
```


```{r, results='asis'}
cat('\\pagebreak')
```
Table 3. Counts, abundance estimates with standard error, coefficient of variation (CV) and 95% confidence intervals (LCL, UCL) and Nmin value for Eastern Bays region of Northern Inland stock from aerial survey data for years between 1983-2019.
```{r,results='asis',echo=FALSE}
EB=read.csv("EBresults.csv")
pander(EB)
```

```{r, results='asis'}
cat('\\pagebreak')
```

Table 4. Counts, abundance estimates with standard error, coefficient of variation (CV) and 95% confidence intervals (LCL, UCL) and Nmin value for San Juan Island region of Northern Inland stock from aerial survey data for years between 1983-2019.
```{r,results='asis',echo=FALSE}
SJI=read.csv("SJIresults.csv")
pander(SJI)
```
```{r, results='asis'}
cat('\\pagebreak')
```

Table 5. Counts, abundance estimates with standard error, coefficient of variation (CV) and 95% confidence intervals (LCL, UCL) and Nmin value for Strait of Juan de Fuca region of Northern Inland stock from aerial survey data for years between 1983-2019.
```{r,results='asis',echo=FALSE}
SJF=read.csv("SJFresults.csv")
pander(SJF)
```

Table 6. Counts, abundance estimates with standard error, coefficient of variation (CV) and 95% confidence intervals (LCL, UCL) and Nmin value for Northern Inland stock from aerial survey data for years between 1983-2019.
```{r,results='asis',echo=FALSE}
NI=read.csv("NIresults.csv")
pander(NI)
```

```{r, results='asis'}
cat('\\pagebreak')
```
Table 7. Counts, abundance estimates with standard error, coefficient of variation (CV) and 95% confidence intervals (LCL, UCL) and Nmin value for Coastal Estuaries region of coastal stock from aerial survey data for years between 1975-2019.
```{r,results='asis',echo=FALSE}
CE=read.csv("CEresults.csv")
pander(CE)
```

```{r, results='asis'}
cat('\\pagebreak')
```

Table 8. Counts, abundance estimates with standard error, coefficient of variation (CV) and 95% confidence intervals (LCL, UCL) and Nmin value for Outer Coast region of coastal stock from aerial survey data for years between 1980-2014.
```{r,results='asis',echo=FALSE}
OC=read.csv("OCresults.csv")
pander(OC)
```

Table 9. Counts, abundance estimates with standard error, coefficient of variation (CV) and 95% confidence intervals (LCL, UCL) and Nmin value for Washington portion of WA-OR coastal stock from aerial survey data for years between 1980-2014.
```{r,results='asis',echo=FALSE}
C=read.csv("Cresults.csv")
pander(C)
```

```{r, results='asis'}
cat('\\pagebreak')
```


Table 10. Parameter estimates and 95% parametric bootstrap confidence intervals (LCL, UCL). Rmax is $R_m$, n0 is $N_0$ in generalized logistic equation.
```{r, results='asis'}
par_N=glmod1$par
gltab=data.frame(Estimate=par_N,LCL=llpar_N,UCL=ulpar_N)
row.names(gltab)=c("z","Rmax - NI","Rmax - C","Rmax - SPS","n0 -SJF","n0 -SJI","n0 -EB","n0 -CE","n0 -OC","n0 -SPS","K -SJF","K -SJI","K -EB","K -CE","K -OC","K -SPS")
pander(gltab)
```



```{r, results='asis'}
cat('\\pagebreak')
```
# Figures


![](Hood_Canal_Stock_Abundance.pdf)
Figure 1. Hood Canal stock abundance estimates with 95% parametric bootstrap confidence intervals (vertical lines).

```{r, results='asis'}
cat('\\pagebreak')
```

![](Southern_Puget_Sound_Stock_GL.pdf)

Figure 2. Southern Puget Sound stock abundance estimates with 95% parametric bootstrap confidence intervals (vertical lines) with fitted generalized logistic population growth curve (solid curved line) with 95% parametric bootstrap confidence intervals (dashed curved lines) and MNPL estimate (solid horizontal line) and 95% parametric bootstrap confidence intervals (dashed horizontal lines).

![](Northern_Inland_GL.pdf)

Figure 3. Regional counts and fitted generalized logistic population growth curve for EB, SJI and SJF regions in upper panels. Lower panel shows Northern Inland stock abundance estimates with 95% parametric bootstrap confidence intervals (vertical lines) and combined regional fitted generalized logistic population growth curve (solid curved line) with 95% parametric bootstrap confidence intervals (dashed curved lines) and MNPL estimate (solid horizontal line) and 95% parametric bootstrap confidence intervals (dashed horizontal lines).

```{r, results='asis'}
cat('\\pagebreak')
```

![](Coastal_Stock_GL.pdf)

Figure 4. Regional counts and fitted generalized logistic population growth curve for CE and OC regions in upper panels. Lower panel shows Washington coastal stock abundance estimates with 95% parametric bootstrap confidence intervals (vertical lines) and combined regional fitted generalized logistic population growth curve (solid curved line) with 95% parametric bootstrap confidence intervals (dashed curved lines) and MNPL estimate (solid horizontal line) and 95% parametric bootstrap confidence intervals (dashed horizontal lines).





